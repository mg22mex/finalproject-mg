{"version":3,"file":"puppeteer/base-page.js","sources":["webpack://@midscene/web/webpack/runtime/define_property_getters","webpack://@midscene/web/webpack/runtime/has_own_property","webpack://@midscene/web/webpack/runtime/make_namespace_object","webpack://@midscene/web/./src/puppeteer/base-page.ts"],"sourcesContent":["__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n        if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n            Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n        }\n    }\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import { WebPageContextParser } from '@/web-element';\nimport type {\n  DeviceAction,\n  ElementTreeNode,\n  Point,\n  Size,\n  UIContext,\n} from '@midscene/core';\nimport type { AbstractInterface } from '@midscene/core/device';\nimport { sleep } from '@midscene/core/utils';\nimport { DEFAULT_WAIT_FOR_NAVIGATION_TIMEOUT } from '@midscene/shared/constants';\nimport type { ElementInfo } from '@midscene/shared/extractor';\nimport { treeToList } from '@midscene/shared/extractor';\nimport { createImgBase64ByFormat } from '@midscene/shared/img';\nimport { type DebugFunction, getDebug } from '@midscene/shared/logger';\nimport {\n  getElementInfosScriptContent,\n  getExtraReturnLogic,\n} from '@midscene/shared/node';\nimport { assert } from '@midscene/shared/utils';\nimport type { Page as PlaywrightPage } from 'playwright';\nimport type { Page as PuppeteerPage } from 'puppeteer';\nimport {\n  type KeyInput,\n  type MouseButton,\n  commonWebActionsForWebPage,\n} from '../web-page';\n\nexport const debugPage = getDebug('web:page');\n\nexport class Page<\n  AgentType extends 'puppeteer' | 'playwright',\n  InterfaceType extends PuppeteerPage | PlaywrightPage,\n> implements AbstractInterface\n{\n  underlyingPage: InterfaceType;\n  protected waitForNavigationTimeout: number;\n  private viewportSize?: Size;\n\n  interfaceType: AgentType;\n\n  actionSpace(): DeviceAction[] {\n    return commonWebActionsForWebPage(this);\n  }\n\n  private async evaluate<R>(\n    pageFunction: string | ((...args: any[]) => R | Promise<R>),\n    arg?: any,\n  ): Promise<R> {\n    let result: R;\n    debugPage('evaluate function begin');\n    if (this.interfaceType === 'puppeteer') {\n      result = await (this.underlyingPage as PuppeteerPage).evaluate(\n        pageFunction,\n        arg,\n      );\n    } else {\n      result = await (this.underlyingPage as PlaywrightPage).evaluate(\n        pageFunction,\n        arg,\n      );\n    }\n    debugPage('evaluate function end');\n    return result;\n  }\n\n  constructor(\n    underlyingPage: InterfaceType,\n    interfaceType: AgentType,\n    opts?: {\n      waitForNavigationTimeout?: number;\n    },\n  ) {\n    this.underlyingPage = underlyingPage;\n    this.interfaceType = interfaceType;\n    this.waitForNavigationTimeout =\n      opts?.waitForNavigationTimeout ?? DEFAULT_WAIT_FOR_NAVIGATION_TIMEOUT;\n  }\n\n  async evaluateJavaScript<T = any>(script: string): Promise<T> {\n    return this.evaluate(script);\n  }\n\n  async waitForNavigation() {\n    if (this.waitForNavigationTimeout === 0) {\n      debugPage('waitForNavigation timeout is 0, skip waiting');\n      return;\n    }\n\n    // issue: https://github.com/puppeteer/puppeteer/issues/3323\n    if (\n      this.interfaceType === 'puppeteer' ||\n      this.interfaceType === 'playwright'\n    ) {\n      debugPage('waitForNavigation begin');\n      debugPage(`waitForNavigation timeout: ${this.waitForNavigationTimeout}`);\n      try {\n        await (this.underlyingPage as PuppeteerPage).waitForSelector('html', {\n          timeout: this.waitForNavigationTimeout,\n        });\n      } catch (error) {\n        // Ignore timeout error, continue execution\n        console.warn(\n          '[midscene:warning] Waiting for the navigation has timed out, but Midscene will continue execution. Please check https://midscenejs.com/faq.html#customize-the-network-timeout for more information on customizing the network timeout',\n        );\n      }\n      debugPage('waitForNavigation end');\n    }\n  }\n\n  // @deprecated\n  async getElementsInfo() {\n    // const scripts = await getExtraReturnLogic();\n    // const captureElementSnapshot = await this.evaluate(scripts);\n    // return captureElementSnapshot as ElementInfo[];\n    await this.waitForNavigation();\n    debugPage('getElementsInfo begin');\n    const tree = await this.getElementsNodeTree();\n    debugPage('getElementsInfo end');\n    return treeToList(tree);\n  }\n\n  async getXpathsById(id: string) {\n    const elementInfosScriptContent = getElementInfosScriptContent();\n\n    return this.evaluateJavaScript(\n      `${elementInfosScriptContent}midscene_element_inspector.getXpathsById('${id}')`,\n    );\n  }\n\n  async getXpathsByPoint(point: Point, isOrderSensitive: boolean) {\n    const elementInfosScriptContent = getElementInfosScriptContent();\n\n    return this.evaluateJavaScript(\n      `${elementInfosScriptContent}midscene_element_inspector.getXpathsByPoint({left: ${point.left}, top: ${point.top}}, ${isOrderSensitive})`,\n    );\n  }\n\n  async getElementInfoByXpath(xpath: string) {\n    const elementInfosScriptContent = getElementInfosScriptContent();\n\n    return this.evaluateJavaScript(\n      `${elementInfosScriptContent}midscene_element_inspector.getElementInfoByXpath('${xpath}')`,\n    );\n  }\n\n  async getElementsNodeTree() {\n    // ref: packages/web-integration/src/playwright/ai-fixture.ts popup logic\n    // During test execution, a new page might be opened through a connection, and the page remains confined to the same page instance.\n    // The page may go through opening, closing, and reopening; if the page is closed, evaluate may return undefined, which can lead to errors.\n    await this.waitForNavigation();\n    const scripts = await getExtraReturnLogic(true);\n    assert(scripts, 'scripts should be set before writing report in browser');\n    const startTime = Date.now();\n    const captureElementSnapshot = await this.evaluate(scripts);\n    const endTime = Date.now();\n    debugPage(`getElementsNodeTree end, cost: ${endTime - startTime}ms`);\n    return captureElementSnapshot as ElementTreeNode<ElementInfo>;\n  }\n\n  async size(): Promise<Size> {\n    if (this.viewportSize) return this.viewportSize;\n    const sizeInfo: Size = await this.evaluate(() => {\n      return {\n        width: document.documentElement.clientWidth,\n        height: document.documentElement.clientHeight,\n        dpr: window.devicePixelRatio,\n      };\n    });\n    this.viewportSize = sizeInfo;\n    return sizeInfo;\n  }\n\n  async screenshotBase64(): Promise<string> {\n    const imgType = 'jpeg';\n    const quality = 90;\n    await this.waitForNavigation();\n    const startTime = Date.now();\n    debugPage('screenshotBase64 begin');\n\n    let base64: string;\n    if (this.interfaceType === 'puppeteer') {\n      const result = await (this.underlyingPage as PuppeteerPage).screenshot({\n        type: imgType,\n        quality,\n        encoding: 'base64',\n      });\n      base64 = createImgBase64ByFormat(imgType, result);\n    } else if (this.interfaceType === 'playwright') {\n      const buffer = await (this.underlyingPage as PlaywrightPage).screenshot({\n        type: imgType,\n        quality,\n        timeout: 10 * 1000,\n      });\n      base64 = createImgBase64ByFormat(imgType, buffer.toString('base64'));\n    } else {\n      throw new Error('Unsupported page type for screenshot');\n    }\n    const endTime = Date.now();\n    debugPage(`screenshotBase64 end, cost: ${endTime - startTime}ms`);\n    return base64;\n  }\n\n  async url(): Promise<string> {\n    return this.underlyingPage.url();\n  }\n\n  describe(): string {\n    const url = this.underlyingPage.url();\n    return url || '';\n  }\n\n  get mouse() {\n    return {\n      click: async (\n        x: number,\n        y: number,\n        options?: { button?: MouseButton; count?: number },\n      ) => {\n        await this.mouse.move(x, y);\n        debugPage(`mouse click ${x}, ${y}`);\n        this.underlyingPage.mouse.click(x, y, {\n          button: options?.button || 'left',\n          count: options?.count || 1,\n        });\n      },\n      wheel: async (deltaX: number, deltaY: number) => {\n        debugPage(`mouse wheel ${deltaX}, ${deltaY}`);\n        if (this.interfaceType === 'puppeteer') {\n          await (this.underlyingPage as PuppeteerPage).mouse.wheel({\n            deltaX,\n            deltaY,\n          });\n        } else if (this.interfaceType === 'playwright') {\n          await (this.underlyingPage as PlaywrightPage).mouse.wheel(\n            deltaX,\n            deltaY,\n          );\n        }\n      },\n      move: async (x: number, y: number) => {\n        this.everMoved = true;\n        debugPage(`mouse move to ${x}, ${y}`);\n        return this.underlyingPage.mouse.move(x, y);\n      },\n      drag: async (\n        from: { x: number; y: number },\n        to: { x: number; y: number },\n      ) => {\n        debugPage(\n          `begin mouse drag from ${from.x}, ${from.y} to ${to.x}, ${to.y}`,\n        );\n        await (this.underlyingPage as PlaywrightPage).mouse.move(\n          from.x,\n          from.y,\n        );\n        await sleep(200);\n        await (this.underlyingPage as PlaywrightPage).mouse.down();\n        await sleep(300);\n        await (this.underlyingPage as PlaywrightPage).mouse.move(to.x, to.y);\n        await sleep(500);\n        await (this.underlyingPage as PlaywrightPage).mouse.up();\n        await sleep(200);\n        debugPage(\n          `end mouse drag from ${from.x}, ${from.y} to ${to.x}, ${to.y}`,\n        );\n      },\n    };\n  }\n\n  get keyboard() {\n    return {\n      type: async (text: string) => {\n        debugPage(`keyboard type ${text}`);\n        return this.underlyingPage.keyboard.type(text, { delay: 80 });\n      },\n      press: async (\n        action:\n          | { key: KeyInput; command?: string }\n          | { key: KeyInput; command?: string }[],\n      ) => {\n        const keys = Array.isArray(action) ? action : [action];\n        debugPage('keyboard press', keys);\n        for (const k of keys) {\n          const commands = k.command ? [k.command] : [];\n          await this.underlyingPage.keyboard.down(k.key, { commands });\n        }\n        for (const k of [...keys].reverse()) {\n          await this.underlyingPage.keyboard.up(k.key);\n        }\n      },\n      down: async (key: KeyInput) => {\n        debugPage(`keyboard down ${key}`);\n        this.underlyingPage.keyboard.down(key);\n      },\n      up: async (key: KeyInput) => {\n        debugPage(`keyboard up ${key}`);\n        this.underlyingPage.keyboard.up(key);\n      },\n    };\n  }\n\n  async clearInput(element: ElementInfo): Promise<void> {\n    if (!element) {\n      console.warn('No element to clear input');\n      return;\n    }\n\n    const backspace = async () => {\n      await sleep(100);\n      await this.keyboard.press([{ key: 'Backspace' }]);\n    };\n\n    const isMac = process.platform === 'darwin';\n    debugPage('clearInput begin');\n    if (isMac) {\n      if (this.interfaceType === 'puppeteer') {\n        // https://github.com/segment-boneyard/nightmare/issues/810#issuecomment-452669866\n        await this.mouse.click(element.center[0], element.center[1], {\n          count: 3,\n        });\n        await backspace();\n      }\n\n      await this.mouse.click(element.center[0], element.center[1]);\n      await this.underlyingPage.keyboard.down('Meta');\n      await this.underlyingPage.keyboard.press('a');\n      await this.underlyingPage.keyboard.up('Meta');\n      await backspace();\n    } else {\n      await this.mouse.click(element.center[0], element.center[1]);\n      await this.underlyingPage.keyboard.down('Control');\n      await this.underlyingPage.keyboard.press('a');\n      await this.underlyingPage.keyboard.up('Control');\n      await backspace();\n    }\n    debugPage('clearInput end');\n  }\n\n  private everMoved = false;\n  private async moveToPointBeforeScroll(point?: Point): Promise<void> {\n    if (point) {\n      await this.mouse.move(point.left, point.top);\n    } else if (!this.everMoved) {\n      // If the mouse has never moved, move it to the center of the page\n      const size = await this.size();\n      const targetX = Math.floor(size.width / 2);\n      const targetY = Math.floor(size.height / 2);\n      await this.mouse.move(targetX, targetY);\n    }\n  }\n\n  async scrollUntilTop(startingPoint?: Point): Promise<void> {\n    await this.moveToPointBeforeScroll(startingPoint);\n    return this.mouse.wheel(0, -9999999);\n  }\n\n  async scrollUntilBottom(startingPoint?: Point): Promise<void> {\n    await this.moveToPointBeforeScroll(startingPoint);\n    return this.mouse.wheel(0, 9999999);\n  }\n\n  async scrollUntilLeft(startingPoint?: Point): Promise<void> {\n    await this.moveToPointBeforeScroll(startingPoint);\n    return this.mouse.wheel(-9999999, 0);\n  }\n\n  async scrollUntilRight(startingPoint?: Point): Promise<void> {\n    await this.moveToPointBeforeScroll(startingPoint);\n    return this.mouse.wheel(9999999, 0);\n  }\n\n  async scrollUp(distance?: number, startingPoint?: Point): Promise<void> {\n    const innerHeight = await this.evaluate(() => window.innerHeight);\n    const scrollDistance = distance || innerHeight * 0.7;\n    await this.moveToPointBeforeScroll(startingPoint);\n    return this.mouse.wheel(0, -scrollDistance);\n  }\n\n  async scrollDown(distance?: number, startingPoint?: Point): Promise<void> {\n    const innerHeight = await this.evaluate(() => window.innerHeight);\n    const scrollDistance = distance || innerHeight * 0.7;\n    await this.moveToPointBeforeScroll(startingPoint);\n    return this.mouse.wheel(0, scrollDistance);\n  }\n\n  async scrollLeft(distance?: number, startingPoint?: Point): Promise<void> {\n    const innerWidth = await this.evaluate(() => window.innerWidth);\n    const scrollDistance = distance || innerWidth * 0.7;\n    await this.moveToPointBeforeScroll(startingPoint);\n    return this.mouse.wheel(-scrollDistance, 0);\n  }\n\n  async scrollRight(distance?: number, startingPoint?: Point): Promise<void> {\n    const innerWidth = await this.evaluate(() => window.innerWidth);\n    const scrollDistance = distance || innerWidth * 0.7;\n    await this.moveToPointBeforeScroll(startingPoint);\n    return this.mouse.wheel(scrollDistance, 0);\n  }\n\n  async navigate(url: string): Promise<void> {\n    debugPage(`navigate to ${url}`);\n    if (this.interfaceType === 'puppeteer') {\n      await (this.underlyingPage as PuppeteerPage).goto(url);\n    } else if (this.interfaceType === 'playwright') {\n      await (this.underlyingPage as PlaywrightPage).goto(url);\n    } else {\n      throw new Error('Unsupported page type for navigate');\n    }\n  }\n\n  async beforeAction(): Promise<void> {\n    await this.waitForNavigation();\n  }\n\n  async destroy(): Promise<void> {}\n\n  async getContext(): Promise<UIContext> {\n    return await WebPageContextParser(this, {});\n  }\n}\n\nexport function forceClosePopup(\n  page: PuppeteerPage | PlaywrightPage,\n  debugProfile: DebugFunction,\n) {\n  page.on('popup', async (popup) => {\n    if (!popup) {\n      console.warn('got a popup event, but the popup is not ready yet, skip');\n      return;\n    }\n    const url = await (popup as PuppeteerPage).url();\n    console.log(`Popup opened: ${url}`);\n    if (!(popup as PuppeteerPage).isClosed()) {\n      try {\n        await (popup as PuppeteerPage).close(); // Close the newly opened TAB\n      } catch (error) {\n        debugProfile(`failed to close popup ${url}, error: ${error}`);\n      }\n    } else {\n      debugProfile(`popup is already closed, skip close ${url}`);\n    }\n\n    if (!page.isClosed()) {\n      try {\n        await page.goto(url);\n      } catch (error) {\n        debugProfile(`failed to goto ${url}, error: ${error}`);\n      }\n    } else {\n      debugProfile(`page is already closed, skip goto ${url}`);\n    }\n  });\n}\n"],"names":["__webpack_require__","definition","key","Object","obj","prop","Symbol","debugPage","getDebug","Page","commonWebActionsForWebPage","pageFunction","arg","result","script","error","console","tree","treeToList","id","elementInfosScriptContent","getElementInfosScriptContent","point","isOrderSensitive","xpath","scripts","getExtraReturnLogic","assert","startTime","Date","captureElementSnapshot","endTime","sizeInfo","document","window","imgType","quality","base64","createImgBase64ByFormat","buffer","Error","url","x","y","options","deltaX","deltaY","from","to","sleep","text","action","keys","Array","k","commands","element","backspace","isMac","process","size","targetX","Math","targetY","startingPoint","distance","innerHeight","scrollDistance","innerWidth","WebPageContextParser","underlyingPage","interfaceType","opts","DEFAULT_WAIT_FOR_NAVIGATION_TIMEOUT","forceClosePopup","page","debugProfile","popup"],"mappings":"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"}